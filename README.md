# 採用シミュレーション: Equal Priority vs Female Priority

このリポジトリは、能力分布が男女で同一（平均 `mu`・標準偏差 `sigma` 共通）であるという前提のもと、2つの採用ポリシーを年次でシミュレーションします。結果として、男女構成や平均能力（全体・男女別）の時系列と比較グラフを出力します。

- Equal-priority（性別無関係の能力選抜）: 性別に関係なく能力上位から採用。
- Female-priority（女性優先）: まず女性の上位から最大 `r` 名を採用し、不足分は任意で性別不問で穴埋め。

能力分布は男女で完全同一です（`mu` と `sigma` が共通）。

## モデルの前提

- 総ポスト数 `P0` は常に一定。
- 毎年、在職者から `r` 名が一様ランダムに離職（空きポスト = `r`）。
- 応募者の能力分布はスタッフと同一（平均 `mu`、標準偏差 `sigma` の正規分布）。
- フィードバック: 応募者の男女比は、現在の在職者の男女比に連動させることが可能。
- 候補者プール: 応募者は採用されるか、最大年限に達するまでプールに残存。

## 基本的なダイナミクス

- 能力分布が同一であれば、Equal-priority では応募者集団の性比に比例して選抜されます（期待値）。
- 在職者の性比は、長期的には応募者の性比へ収束します（期待値）。
- フィードバックを入れると、応募者の性比が在職者の性比に部分的に追随し、内生的なダイナミクスが生じます。

## 使い方（CLI）

Equal priority と Female priority を比較し、グラフを表示/保存します。

```bash
python sim.py \
  --T 30 \
  --P0 200 \
  --x 80 \
  --y 70 \
  --r 20 \
  --mu 0 \
  --sigma 1 \
  --seed 42 \
  --feedback-strength 0.0 \
  --max-candidate-years 10 \
  [--no-backfill] \
  [--save out.png]
```

- `--save` を省略すると、インタラクティブにウィンドウ表示します。
- 図タイトルに feedback strength（フィードバック強度）が表示されます。
- コンソールには、開始時と終了時の在職者数と平均能力のサマリを表示します。

### パラメータ

- `--T`（int, 既定 30）: シミュレーション年数。
- `--P0`（int, 既定 200）: 初期（かつ一定）のポスト数。
- `--x`（float, 既定 80.0）: 初期在職者の男性割合（%）。
- `--y`（float, 既定 70.0）: 新規応募者の基準となる男性割合（%）。
- `--r`（int, 既定 20）: 毎年の離職者数（= 採用枠）。
- `--mu`（float, 既定 0.0）: 能力分布の平均（男女共通）。
- `--sigma`（float, 既定 1.0）: 能力分布の標準偏差（男女共通）。
- `--seed`（int, 既定 42）: 乱数シード（再現性のため）。
- `--feedback-strength`（float, 0〜1, 既定 0.0）: 応募者の男性割合を在職者の男性割合へブレンド。
  - `y_eff = (1-phi)*y + phi*(100*staff_male_share)`
- `--max-candidate-years`（int, 既定 10）: 採用されない応募者が候補者プールに在籍できる最大年限。
- `--applicants-multiplier`（float, 既定 1.0）: 応募倍率 k。毎年の新規応募者数を `round(r * k)` とする（k>1 で選抜が強まり、平均能力が上がりやすくなる）。
- `--stop-female-priority-at`（float, 既定 50.0）: 在職女性比がこの%に達したら、以後は female-priority を停止し equal-priority に切替。
- `--no-backfill`（フラグ, 既定 False）: Female-priority で女性が `r` に満たない場合に穴埋めしない。
- `--save`（パス, 任意）: 図を保存（省略時は画面表示）。

### 出力（プロット）

2×2 の図を出力します。

- 女性比率（%）: 実線 = 在職者、点線 = 応募者（期待値）。
- 男女人数: 男性（実線）、女性（破線）。
- 平均能力（全体）: 在職者全体の平均能力。
- 平均能力（男女別）: 男性・女性の平均能力。

## Python API

Python から直接呼び出すことも可能です。

```python
from sim import simulate

res = simulate(
    T=30, P0=200, x=80.0, y=70.0, r=20,
    mu=0.0, sigma=1.0, seed=42,
    mode="equal_priority",         # もしくは "female_priority"
    backfill_if_short=True,         # female_priority のみ有効
    feedback_strength=0.5,          # 0..1
    max_candidate_years=10,
)

stats = res["stats"]  # YearStats（dataclass）のリスト
```

## インストール

- 推奨: Python 3.9+
- 依存関係のインストール:

```bash
pip install numpy matplotlib
```

環境によっては、matplotlib の描画バックエンドを設定（例: TkAgg）するか、`--save` でファイル出力にする必要があります。

## 注意点

- t=0 では、初期在職者の平均能力が厳密に `mu` になるように再中心化しています。以降は離職・採用により確率的に変動します。
- 制約によって採用枠が埋まらない場合でも、総ポスト数を一定に保つため、非常に低スコアのダミーで補充しています（帳尻合わせ用）。
- 男女の能力分布は同一であり、差が出るのは選抜ルール（ポリシー）と応募者の性比ダイナミクスによるものです。
